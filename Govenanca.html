<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment de Maturidade em Governança - PEERS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        :root {
            --peers-blue: #011334;
            --peers-lime: #E1FF00;
            --peers-gray: #F2F2F2;
            --peers-serene: #D8E8EE;
        }
        
        .bg-peers-blue { background-color: var(--peers-blue); }
        .bg-peers-lime { background-color: var(--peers-lime); }
        .bg-peers-gray { background-color: var(--peers-gray); }
        .text-peers-blue { color: var(--peers-blue); }
        .text-peers-lime { color: var(--peers-lime); }
        .border-peers-blue { border-color: var(--peers-blue); }
        .border-peers-lime { border-color: var(--peers-lime); }
        
        .btn-primary {
            background-color: var(--peers-lime);
            color: var(--peers-blue);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(1, 19, 52, 0.2);
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--peers-blue);
            border: 2px solid var(--peers-blue);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background-color: var(--peers-blue);
            color: white;
        }
        
        .maturity-option {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .maturity-option:hover {
            transform: scale(1.05);
        }
        
        .maturity-option.selected {
            background-color: var(--peers-lime);
            color: var(--peers-blue);
            font-weight: 600;
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(225, 255, 0, 0.4);
        }
        
        .info-icon {
            width: 16px;
            height: 16px;
            background: var(--peers-blue);
            color: white;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: help;
            position: absolute;
            top: 2px;
            right: 2px;
        }
        
        .principle-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(1, 19, 52, 0.08);
            border: 1px solid rgba(1, 19, 52, 0.05);
        }
        
        .question-card {
            background: rgba(242, 242, 242, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid rgba(1, 19, 52, 0.05);
        }
        
        .gradient-header {
            background: linear-gradient(135deg, var(--peers-blue) 0%, #022456 100%);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .spinner {
            border: 4px solid var(--peers-gray);
            border-top: 4px solid var(--peers-lime);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .recommendation-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .recommendation-level-1 { border-left: 4px solid #EF4444; }
        .recommendation-level-2 { border-left: 4px solid #F59E0B; }
        .recommendation-level-3 { border-left: 4px solid #EAB308; }
        .recommendation-level-4 { border-left: 4px solid #84CC16; }
        .recommendation-level-5 { border-left: 4px solid #10B981; }
        
        .progress-bar {
            height: 8px;
            background: #E5E5E5;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--peers-lime);
            transition: width 0.3s ease;
        }
        
        .score-card {
            background: linear-gradient(135deg, var(--peers-blue) 0%, #022456 100%);
            border-radius: 16px;
            padding: 32px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .score-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(225, 255, 0, 0.1) 0%, transparent 70%);
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
        }
        .maturity-option {
    position: relative;
    transition: all 0.3s ease;
    cursor: pointer;
}

.maturity-option:hover {
    transform: scale(1.05);
}

/* Estado selecionado - IMPORTANTE */
.maturity-option.selected {
    background: linear-gradient(135deg, #E1FF00 0%, #d4f000 100%);
    color: #011334;
    font-weight: 600;
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(225, 255, 0, 0.4);
    border-color: #E1FF00;
}

.maturity-option.selected .info-icon {
    background: #011334;
    color: white;
    border-color: #011334;
}

.info-icon {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    border: 1.5px solid #9CA3AF;
    background: white;
    color: #6B7280;
    font-size: 11px;
    font-style: italic;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none; /* IMPORTANTE: não interfere no clique */
    z-index: 2;
}

.tooltip {
    position: absolute;
    top: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    background: white;
    color: #011334;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 11px;
    line-height: 1.4;
    width: 180px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border: 1px solid #E5E7EB;
    opacity: 0;
    visibility: hidden;
    pointer-events: none; /* IMPORTANTE: não interfere no clique */
    transition: all 0.2s ease;
    z-index: 50;
    text-align: left;
}

.tooltip::before {
    content: '';
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 5px solid transparent;
    border-bottom-color: white;
}

.maturity-option:hover .tooltip {
    opacity: 1;
    visibility: visible;
}
    </style>
</head>
<body class="bg-peers-gray">
    <!-- Header -->
    <header class="gradient-header text-white py-6 px-4 shadow-lg no-print">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
            <img src="https://d3fh32tca5cd7q.cloudfront.net/wp-content/uploads/2025/03/logo.svg" 
                 alt="PEERS" 
                 style="height: 45px; width: auto; display: block; margin: 0 auto 1.5rem;">
                    <div class="h-8 w-px bg-peers-lime opacity-50"></div>
                    <h1 class="text-xl font-light">Assessment de Maturidade</h1>
                </div>
                <div id="progressIndicator" class="hidden">
                    <span class="text-sm opacity-80">Progresso: </span>
                    <span id="progressText" class="font-semibold">0/15</span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="fade-in">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <div class="text-center mb-8">
                        <div class="bg-blue-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-10 h-10 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                        </div>
                        <h2 class="text-3xl font-bold text-peers-blue mb-4">Assessment de Governança Corporativa</h2>
                        <p class="text-gray-600 mb-6">Avalie o nível de maturidade da sua organização em práticas essenciais de governança corporativa</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-8">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-semibold text-peers-blue mb-2">O que será avaliado:</h3>
                            <ul class="space-y-1 text-sm text-gray-600">
                                <li>• Transparência além do discurso</li>
                                <li>• Equidade aos stakeholders</li>
                                <li>• Accountability nas decisões</li>
                                <li>• Ferramentas de integridade corporativa</li>
                                <li>• Sustentabilidade e continuidade do negócio</li>
                            </ul>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-semibold text-peers-blue mb-2">Como funciona:</h3>
                            <ul class="space-y-1 text-sm text-gray-600">
                                <li>• 15 perguntas objetivas</li>
                                <li>• Escala de maturidade 1-5</li>
                                <li>• Tempo estimado: 5-10 minutos</li>
                                <li>• Relatório com recomendações</li>
                                <li>• Análise por princípio</li>
                            </ul>
                        </div>
                    </div>
                    
                    <button onclick="startAssessment()" class="w-full btn-primary py-4 px-8 rounded-lg font-semibold text-lg">
                        Iniciar Assessment de Governança
                    </button>
                </div>
            </div>
        </div>

        <!-- Assessment Questions -->
        <div id="assessmentQuestions" class="hidden">
            <div class="max-w-5xl mx-auto">
                <!-- Progress Bar -->
                <div class="bg-white rounded-lg p-4 mb-6 shadow-sm">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">Progresso do Assessment</span>
                        <span class="text-sm font-bold text-peers-blue"><span id="answeredCount">0</span> de 15 respondidas</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressBar" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Questions Container -->
                <div id="questionsContainer"></div>

                <!-- Action Buttons -->
                <div class="flex gap-4 justify-center mt-8 no-print">
                    <button onclick="checkAndProceed()" class="btn-primary py-3 px-8 rounded-lg font-semibold">
                        Gerar Relatório
                    </button>
                </div>
            </div>
        </div>

        <!-- Lead Gate (After Assessment) -->
        <div id="leadGate" class="hidden fade-in">
            <div class="max-w-md mx-auto">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-bold text-peers-blue mb-2">Assessment Concluído!</h2>
                        <p class="text-gray-600">Para receber seu relatório personalizado com todas as recomendações, preencha os dados abaixo:</p>
                    </div>
                    
                    <form id="leadForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nome Completo *</label>
                            <input type="text" id="userName" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-peers-lime focus:border-transparent"
                                   placeholder="Seu nome">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Empresa *</label>
                            <input type="text" id="userCompany" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-peers-lime focus:border-transparent"
                                   placeholder="Nome da empresa">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">E-mail Corporativo *</label>
                            <input type="email" id="userEmail" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-peers-lime focus:border-transparent"
                                   placeholder="seu.email@empresa.com">
                        </div>
                        <div class="pt-2">
                            <label class="flex items-start gap-2">
                                <input type="checkbox" id="acceptTerms" required class="mt-1">
                                <span class="text-xs text-gray-600">
                                    Concordo em receber o relatório por e-mail e autorizo o contato da PEERS para apresentação de soluções relacionadas.
                                </span>
                            </label>
                        </div>
                        <button type="submit" class="w-full btn-primary py-3 px-6 rounded-lg font-semibold">
                            Visualizar Relatório Completo
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Report -->
        <div id="reportSection" class="hidden">
            <div class="max-w-6xl mx-auto">
                <!-- Report Header -->
                <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-3xl font-bold text-peers-blue mb-2">Relatório de Maturidade</h2>
                            <p class="text-gray-600">Assessment de Governança Corporativa</p>
                        </div>
                        <div class="text-right">
                            <!-- <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 40'%3E%3Ctext x='0' y='30' font-size='28' font-weight='700' font-family='Poppins' fill='%23011334'%3EPEERS%3C/text%3E%3C/svg%3E" 
                                 alt="PEERS" class="h-10 inline-block"> -->
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-6 mb-6">
                        <div>
                            <p class="text-sm text-gray-600">Responsável</p>
                            <p class="font-semibold text-peers-blue" id="reportName"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Empresa</p>
                            <p class="font-semibold text-peers-blue" id="reportCompany"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Data</p>
                            <p class="font-semibold text-peers-blue" id="reportDate"></p>
                        </div>
                    </div>
                    
                    <!-- Overall Score Card com fundo azul -->
                    <div class="score-card">
                        <p class="text-xl mb-3 opacity-90">Nível de Maturidade Geral</p>
                        <div class="flex items-baseline gap-4 mb-3">
                            <span class="text-6xl font-bold text-peers-lime" id="overallScore"></span>
                            <span class="text-2xl text-peers-lime" id="overallLevel"></span>
                        </div>
                        <p class="text-sm opacity-90" id="scoreDescription"></p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-peers-blue mb-4">Maturidade por Princípio</h3>
                        <canvas id="radarChart"></canvas>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-peers-blue mb-4">Distribuição de Respostas</h3>
                        <canvas id="barChart"></canvas>
                    </div>
                </div>

                <!-- All Recommendations -->
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h3 class="text-2xl font-bold text-peers-blue mb-6">Plano de Recomendações por Princípio</h3>
                    <p class="text-gray-600 mb-6">Recomendações consolidadas para evolução da maturidade em cada princípio de governança:</p>
                    <div id="recommendationsContainer"></div>
                </div>

                <!-- Actions -->
                <div class="flex gap-4 justify-center mt-8 no-print">
                    <button onclick="printReport()" class="btn-secondary py-3 px-8 rounded-lg font-semibold">
                        📄 Imprimir Relatório
                    </button>
                    <!-- <button onclick="downloadReport()" class="btn-secondary py-3 px-8 rounded-lg font-semibold">
                        📥 Baixar PDF
                    </button> -->
                    <button onclick="startNewAssessment()" class="btn-primary py-3 px-8 rounded-lg font-semibold">
                        Novo Assessment
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Data structure for governance assessment
        const assessmentData = {
            title: "Assessment de Governança Corporativa",
            principles: {
                "Princípio 1: Transparência além do discurso": [
                    "Nossa organização divulga informações financeiras e não financeiras de forma clara, completa e acessível a todas as partes interessadas (acionistas, colaboradores, clientes, fornecedores, comunidade, etc.)?",
                    "Existem canais formais e eficazes para que as partes interessadas possam solicitar informações e obter respostas de forma tempestiva?",
                    "As decisões estratégicas e os processos de tomada de decisão são comunicados de forma transparente, explicando os motivos e impactos?"
                ],
                "Princípio 2: Equidade aos stakeholders": [
                    "Nossa organização garante tratamento justo e igualitário a todos os acionistas, independentemente do tipo ou volume de suas ações?",
                    "Existem políticas e práticas claras que asseguram a não discriminação e o respeito à diversidade entre colaboradores, clientes e fornecedores?",
                    "Os processos de seleção, promoção e remuneração são baseados em critérios objetivos e meritocráticos, livres de favoritismo ou conflitos de interesse?"
                ],
                "Princípio 3: Accountability nas decisões": [
                    "O conselho de administração e a alta direção prestam contas regularmente sobre o desempenho e as decisões da organização?",
                    "Existem mecanismos claros de responsabilização, com definição de papéis, responsabilidades e consequências para o não cumprimento de metas ou políticas?",
                    "A organização possui auditorias internas e externas independentes que avaliam e reportam sobre a conformidade e o desempenho?"
                ],
                "Princípio 4: Ferramentas de integridade Corporativa": [
                    "Nossa organização considera os impactos sociais, ambientais e econômicos de suas atividades nas decisões estratégicas?",
                    "Existem políticas e práticas de sustentabilidade implementadas e monitoradas regularmente?",
                    "A organização mantém um relacionamento ético e responsável com todas as partes interessadas, contribuindo para o desenvolvimento sustentável da sociedade?"
                ],
                "Princípio 5: Sustentabilidade e continuidade do negócio": [
                    "A organização possui um programa de compliance estruturado, com políticas, procedimentos e treinamentos para garantir o cumprimento de leis e regulamentos?",
                    "Existe um canal de denúncias confidencial e eficaz, com proteção ao denunciante e investigação adequada das alegações?",
                    "A alta administração demonstra compromisso com a conformidade, estabelecendo o 'tom do topo' e alocando recursos adequados para o programa de compliance?"
                ]
            }
        };

        const maturityLevels = {
            1: {
                name: "Não fazemos",
                description: "A prática não é relevante para nossa organização ou não a implementamos de forma alguma.",
                color: "#EF4444"
            },
            2: {
                name: "Iniciando",
                description: "Reconhecemos a importância da prática e estamos começando a explorá-la ou implementá-la de forma muito limitada.",
                color: "#F59E0B"
            },
            3: {
                name: "Em desenvolvimento",
                description: "Temos algumas práticas implementadas, mas ainda há muito espaço para melhoria e formalização.",
                color: "#EAB308"
            },
            4: {
                name: "Consolidado",
                description: "A prática está bem estabelecida e formalizada em nossa organização, com resultados visíveis.",
                color: "#84CC16"
            },
            5: {
                name: "Excelência",
                description: "A prática é um ponto forte da nossa organização, com melhoria contínua e alinhamento estratégico.",
                color: "#10B981"
            }
        };

        // Sample recommendations from the spreadsheet structure
        const recommendationsByLevel = {
            1: "É crucial que a organização inicie a implementação desta prática fundamental. Recomenda-se começar com ações básicas, como a conscientização da liderança sobre a importância do tema e a designação de um responsável para liderar as primeiras iniciativas.",
            2: "Formalizar o compromisso da organização com esta prática através de políticas documentadas. Promover sessões de conscientização e treinamento básico para as equipes-chave. Estabelecer métricas iniciais para acompanhar o progresso.",
            3: "Aprimorar e expandir as práticas existentes, integrando-as aos processos de negócio. Implementar ferramentas e sistemas de suporte. Desenvolver programas de capacitação contínua e estabelecer indicadores de desempenho mais robustos.",
            4: "Buscar a excelência através da otimização contínua dos processos. Considerar certificações relevantes e benchmarking com líderes do mercado. Compartilhar conhecimento internamente e promover a inovação nas práticas.",
            5: "Manter a posição de liderança através da inovação contínua e compartilhamento de melhores práticas com o mercado. Servir como referência para outras organizações e contribuir para o avanço do setor."
        };

        // Global variables
        let responses = {};
        let userData = {};

        function startAssessment() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('assessmentQuestions').classList.remove('hidden');
            document.getElementById('progressIndicator').classList.remove('hidden');
            renderQuestions();
        }

        function renderQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            let questionNumber = 1;
            
            Object.entries(assessmentData.principles).forEach(([principle, questions]) => {
                const principleDiv = document.createElement('div');
                principleDiv.className = 'principle-card fade-in';
                
                const principleTitle = document.createElement('h3');
                principleTitle.className = 'text-xl font-bold text-peers-blue mb-4';
                principleTitle.textContent = principle;
                principleDiv.appendChild(principleTitle);
                
                questions.forEach((question, qIndex) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-card';
                    
                    const questionText = document.createElement('p');
                    questionText.className = 'font-medium text-gray-800 mb-4';
                    questionText.innerHTML = `<span class="text-peers-blue font-bold">${questionNumber}.</span> ${question}`;
                    questionDiv.appendChild(questionText);
                    
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'flex flex-wrap gap-3';
                    
                    for (let level = 1; level <= 5; level++) {
                        const option = document.createElement('div');
                        option.className = 'maturity-option bg-white border-2 border-gray-200 rounded-lg px-4 py-3 text-center flex-1 min-w-[100px] relative';
                        option.innerHTML = `
<span class="info-icon">i</span>
        <div class="tooltip">${maturityLevels[level].description}</div>
        <div class="text-2xl font-bold" style="color: ${maturityLevels[level].color}">${level}</div>
        <div class="text-xs mt-1">${maturityLevels[level].name}</div>

                        `;
                        option.onclick = () => selectAnswer(principle, qIndex, level, option);
                        optionsDiv.appendChild(option);
                    }
                    
                    questionDiv.appendChild(optionsDiv);
                    principleDiv.appendChild(questionDiv);
                    questionNumber++;
                });
                
                container.appendChild(principleDiv);
            });
        }

        function selectAnswer(principle, questionIndex, level, element) {
            // Initialize responses for principle if not exists
            if (!responses[principle]) {
                responses[principle] = {};
            }
            
            // Store the response
            responses[principle][questionIndex] = level;
            
            // Update UI
            const parent = element.parentElement;
            parent.querySelectorAll('.maturity-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // Update progress
            updateProgress();
        }

        function updateProgress() {
            let totalAnswered = 0;
            Object.values(responses).forEach(principle => {
                totalAnswered += Object.keys(principle).length;
            });
            
            const percentage = (totalAnswered / 15) * 100;
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('answeredCount').textContent = totalAnswered;
            document.getElementById('progressText').textContent = `${totalAnswered}/15`;
        }

        function checkAndProceed() {
            let totalAnswered = 0;
            Object.values(responses).forEach(principle => {
                totalAnswered += Object.keys(principle).length;
            });
            
            if (totalAnswered < 15) {
                alert('Por favor, responda todas as 15 perguntas antes de continuar.');
                return;
            }
            
            document.getElementById('assessmentQuestions').classList.add('hidden');
            document.getElementById('leadGate').classList.remove('hidden');
        }

        document.getElementById('leadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            userData = {
                name: document.getElementById('userName').value,
                company: document.getElementById('userCompany').value,
                email: document.getElementById('userEmail').value
            };
            
            showReport();
        });

        function showReport() {
            document.getElementById('leadGate').classList.add('hidden');
            document.getElementById('reportSection').classList.remove('hidden');
            document.getElementById('progressIndicator').classList.add('hidden');
            
            // Set user data in report
            document.getElementById('reportName').textContent = userData.name;
            document.getElementById('reportCompany').textContent = userData.company;
            document.getElementById('reportDate').textContent = new Date().toLocaleDateString('pt-BR');
            
            // Calculate scores
            const principleScores = {};
            let totalScore = 0;
            let totalResponses = 0;
            
            Object.entries(responses).forEach(([principle, questions]) => {
                const scores = Object.values(questions);
                const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
                principleScores[principle] = avgScore;
                totalScore += scores.reduce((a, b) => a + b, 0);
                totalResponses += scores.length;
            });
            
            const overallScore = (totalScore / totalResponses).toFixed(1);
            const overallLevel = Math.round(overallScore);
            
            document.getElementById('overallScore').textContent = overallScore;
            document.getElementById('overallLevel').textContent = maturityLevels[overallLevel].name;
            document.getElementById('scoreDescription').textContent = maturityLevels[overallLevel].description;
            
            // Generate charts
            generateCharts(principleScores);
            
            // Generate ALL recommendations - VERSÃO CORRIGIDA
            generateAllRecommendations();
        }

        function generateCharts(principleScores) {
            // Radar Chart
            const radarCtx = document.getElementById('radarChart').getContext('2d');
            const labels = Object.keys(principleScores).map(p => p.split(':')[0]);
            const data = Object.values(principleScores);
            
            new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nível de Maturidade',
                        data: data,
                        backgroundColor: 'rgba(225, 255, 0, 0.2)',
                        borderColor: '#E1FF00',
                        pointBackgroundColor: '#E1FF00',
                        pointBorderColor: '#011334',
                        pointBorderWidth: 2,
                        borderWidth: 2
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Bar Chart
            const barCtx = document.getElementById('barChart').getContext('2d');
            const levelCounts = [0, 0, 0, 0, 0];
            
            Object.values(responses).forEach(principle => {
                Object.values(principle).forEach(level => {
                    levelCounts[level - 1]++;
                });
            });
            
            new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['Nível 1', 'Nível 2', 'Nível 3', 'Nível 4', 'Nível 5'],
                    datasets: [{
                        label: 'Quantidade de Respostas',
                        data: levelCounts,
                        backgroundColor: [
                            '#EF4444',
                            '#F59E0B',
                            '#EAB308',
                            '#84CC16',
                            '#10B981'
                        ]
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // FUNÇÃO CORRIGIDA - Mostra apenas o consolidado por princípio
function generateAllRecommendations() {
    const container = document.getElementById('recommendationsContainer');
    container.innerHTML = '';
    
    Object.entries(responses).forEach(([principle, questions]) => {
        const scores = Object.values(questions);
        const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
        const currentLevel = Math.round(avgScore);
        
        const principleDiv = document.createElement('div');
        principleDiv.className = 'mb-6 p-6 bg-white rounded-xl border border-gray-200 shadow-sm';
        
        // MOSTRA APENAS O NÍVEL ATUAL E A PRÓXIMA RECOMENDAÇÃO
        principleDiv.innerHTML = `
            <h4 class="text-xl font-bold text-peers-blue mb-3">${principle}</h4>
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold mb-4" 
                 style="background-color: ${maturityLevels[currentLevel].color}20; color: ${maturityLevels[currentLevel].color}">
                <span>Nível Médio: ${avgScore.toFixed(1)} - ${maturityLevels[currentLevel].name}</span>
            </div>
            
            ${currentLevel < 5 ? `
                <div class="p-4 rounded-lg border-l-4" style="border-color: ${maturityLevels[currentLevel + 1].color}; background: #f9f9f9;">
                    <p class="font-bold text-sm mb-2" style="color: ${maturityLevels[currentLevel + 1].color}">
                        Para alcançar o Nível ${currentLevel + 1} - ${maturityLevels[currentLevel + 1].name}:
                    </p>
                    <p class="text-sm text-gray-700">${recommendationsByLevel[currentLevel + 1]}</p>
                </div>
            ` : `
                <div class="p-4 rounded-lg bg-green-50 border-l-4 border-green-500">
                    <p class="font-bold text-green-700">Excelência Alcançada!</p>
                    <p class="text-sm text-gray-700">${recommendationsByLevel[5]}</p>
                </div>
            `}
        `;
        
        container.appendChild(principleDiv);
    });
}

        function printReport() {
            window.print();
        }

        function downloadReport() {
            alert('Funcionalidade de download será implementada em breve. Por enquanto, use a opção de imprimir e salve como PDF.');
        }

        function startNewAssessment() {
            responses = {};
            document.getElementById('reportSection').classList.add('hidden');
            document.getElementById('welcomeScreen').classList.remove('hidden');
        }
    </script>
</body>
</html>